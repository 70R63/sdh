apply plugin: 'installer-platform-plugin'
apply plugin: 'installer-addon-plugin'

def subpl = platformFactory.createPlatform()
def orbeonDir = "${suiteHome}/../orbeon-module"

def config = {
	localProperties {
		property 'storefront.show.debug.info', 'false'
		property 'datahub.extension.exportURL', 'http://localhost:9001/datahubadapter'
		property 'datahub.extension.userName', 'admin'
		property 'datahub.extension.password', 'nimda'
		property 'datahub.server.url', 'http://localhost:8080/datahub-webapp/v1'
		property 'datahubadapter.datahuboutbound.url', 'http://localhost:8080/datahub-webapp/v1'
		property 'registration.consent.id.publicsector', 'MARKETING_NEWSLETTER'
		property 'publicsector.application.domain.whitelist', 'publicsector.local'
		
		property 'publicsectorservices.encoder.algorithm', 'AES'
		property 'publicsectorservices.encoder.aes.key', 'd2cb415e067c7b13'
		property 'publicsectorservices.encoder.encryption.cipher', 'AES/CBC/PKCS5Padding'
		property 'publicsectorservices.encoder.initialization.vector', 'e36dc751d0433f05'
		property 'mail.from', 'hcea2018@gmail.com'
		property 'mail.replyto', 'hcea2018@gmail.com'
		property 'mail.smtp.server', 'smtp.gmail.com'
		property 'mail.smtp.port', '587'
		property 'mail.smtp.user', 'hcea2018@gmail.com'
		property 'mail.smtp.password', 'hcea@1234'
		property 'mail.use.tls', 'true'
	}

	extensions {

		extensionNames(
			"backoffice",
			"cmsbackoffice",
			"customersupportbackoffice",
			/*SDH Custom Extension*/
			"sdhcore",
			"sdhfacades",
			"sdhstorefront",
			"sdhinitialdata",
			"sdhtest",
			"sdhcockpits",
			"ycommercewebservices",
			"commercesearchbackoffice",
			"commerceservicesbackoffice",
			"solrfacetsearchbackoffice",
			"solrserver",
			
			"configurablebundlecockpits",
			"configurablebundlefacades",
			"configurablebundleservices",

			
  			"assistedservicestorefront",
     		"assistedserviceatddtests",
     		
     		/*Smart Edit Extensions*/
			"smarteditaddon",
			"smarteditwebservices",
			"cmssmartedit",
			"cmswebservices",
			"cmssmarteditwebservices",
			"npmtestancillary",
			"previewwebservices",
			"permissionswebservices",

			/* yform extensions */
			"xyformscockpits",
			"xyformsbackoffice",
			"orbeonweb",
			"xyformscommerceservices",
			"xyformscommercefacades",
			"xyformscommercecockpits",
			
			/* datahub adapter extensions */
			"datahubadapter",
			"datahubbackoffice",
			"datahubclient",
			/* publicsector addons */
			"publicsectoracceleratoraddon",
			
			/* publicsector extensions */
			"publicsectorservices",
			"publicsectorstore",
			"publicsectoratddtests",
			"publicsectorcockpits",
			"publicsectorfacades",
			"publicsectorfulfilment",
			"publicsectorconsignmentexchange",
			"publicsectordocmanagement",
			"publicsectordocmanagementexchange",
			"relationshipexchange",
			"publicsectorbackoffice",
			"xyformscommercebackoffice",
			"xyformscommerceatddtests",
			
			/* bill extensions */
			"billservices",
			"billaddon",
			"billfacades",
			"billbackoffice",
			"billatddtests",
			"billexchange",
			
			/* relationship extensions */
			"relationshipservices",
			"relationshipaddon",
			"relationshipbackoffice",
			"relationshipfacades",
			"relationshipatddtests",
			"auditreportservices",

			/* lucenesearch, lucenesearchbackoffice // extensions have been removed in Hybris 6.7 */

		)

	}
}

def pl = platform(config)

task setup << {
	
	pl.setup()
	
	pl.project.addons {
		names "xyformsstorefrontcommons,relationshipaddon,billaddon,publicsectoracceleratoraddon,smarteditaddon,assistedservicestorefront"
		template "yacceleratorstorefront"
		storeFronts "sdhstorefront"
		platform pl
	}
	
	copy {
        from platformHome + "/../ext-publicsector/publicsectorsolrlangsupport/resources/solr/server/solr/configsets/conf/schema.xml"
        into platformHome + "/../ext-commerce/solrserver/resources/solr/server/solr/configsets/default/conf"
        println "Updating Solr Schema with Spanish language."
    	}
	copy {
	     from platformHome + "/../ext-publicsector/publicsectorsolrlangsupport/resources/solr/server/solr/configsets/conf/solrconfig.xml"
	     into platformHome + "/../ext-commerce/solrserver/resources/solr/server/solr/configsets/default/conf"
	     println "Updating Solr Config with Spanish language."
	 }
}

task initialize << {
	pl.build()
	pl.initialize()
}

task start << {
	pl.startInBackground()
}

task stop << {
	pl.stopInBackground()
}
